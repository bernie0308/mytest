var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,i=(e,t,o)=>(s(e,"symbol"!=typeof t?t+"":t,o),o);import{a as l,m as c,c as u,d,L as p,D as m,U as f,A as h,u as g,b as v,r as b,w as y,e as _,o as w,f as L,g as O,h as k,i as I,F as S,j,k as E,l as P,n as D,t as U,p as A,q as C,s as N,v as V,x,y as R,z as $,B as M,C as T,E as q,G as z,M as J,I as K}from"./vendor.946f890b.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let B;class F{constructor(e){i(this,"ssoLogin"),i(this,"ssoLogout"),i(this,"hasLoginToken"),this.ssoLogin=()=>{!function(e){localStorage.setItem("__lastUrlCache",`//${location.host}`);const t=location.origin;window.location.href=t+e}(e.loginUrl)},this.ssoLogout=()=>{!function(e){const t=window.origin;window.localStorage.removeItem("fn_userinfo"),window.location.href=t+e}(e.logoutUrl)},this.hasLoginToken=()=>function(){const e=G("code");return Boolean(e&&""!==e)}()}install(e){e.config.globalProperties.$sso=B}handleLogin(e){return new Promise(((t,o)=>{const r=G("code");if(!r)return;const n=location.origin+e.api,a={token:r};fetch(n,{method:"post",body:JSON.stringify(a),headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"}}).then((e=>e.json())).then((e=>{if(200===Number(e.code)){t(e),window.localStorage.setItem("fn_userinfo",JSON.stringify(e.data));const o=localStorage.getItem("__lastUrlCache")||location.origin;o&&(window.location.href=o)}else o(e)})).catch((e=>{console.log("err",e)}))}))}}function G(e){const t=location.toString().split("?");if(t.length>1){let o;return t[1].split("&").forEach((t=>{const r=t.split("="),n=r.length>1?r[0]:"",a=r[1];n&&n===e&&(o=a)})),o}return""}const H=()=>{if(!B)return console.error("请先初始化SSO");B.ssoLogout()},W=l.create({baseURL:"/api",withCredentials:!1,timeout:6e4});W.interceptors.request.use((e=>e),(e=>(console.log(e),Promise.reject(e)))),W.interceptors.response.use((e=>{const t=e.data;return console.log("response",e.data),200!==t.code?(401===t.code?(()=>{if(!B)return console.error("请先初始化SSO");B.ssoLogin()})():403===t.code?window.location.href="//"+window.location.host+"/error":c.error(t.msg||"抱歉, 出现未知错误, 请稍后再试"),Promise.reject(new Error(t.msg||"Error"))):t.data}),(e=>(console.log("err"+e),c.error("抱歉, 出现未知错误, 请稍后再试"),Promise.reject(e))));const Q=u({modules:{user:{namespaced:!0,state:{userID:null,name:null,avatar:null,email:null,store:localStorage.getItem("store")||"us"},mutations:{setUserinfo(e,t={}){e.userID=t.userID,e.name=t.full_name,e.avatar=t.avatar,e.email=t.email},setStore(e,t){e.store=t,localStorage.setItem("store",t)}},actions:{getUser:({commit:e})=>W({url:"/sso/auth",method:"get"}).then((t=>{console.log(123123),e("setUserinfo",t)})).catch((e=>{console.error("ERROR getUser:",e)}))}},base:{namespaced:!0,state:{navbarVisible:!0},mutations:{setNavBarVisible(e,t=!0){console.log("navbarVisible",t),e.navbarVisible=t}}}},getters:{name:e=>e.user.name,userID:e=>e.user.userID,avatar:e=>e.user.avatar,email:e=>e.user.email,navbarVisible:e=>e.base.navbarVisible,store:e=>e.user.store}});var X=(e,t)=>{for(const[o,r]of t)e[o]=r;return e};const Y=d({name:"Navabar",components:{LogoutOutlined:p,DownOutlined:m,UserOutlined:f,AppstoreAddOutlined:h},props:{data:{type:Array,default:()=>[]},userinfo:{type:Object,default:()=>({})}},setup(e,i){g();const l=v(),c=window.location.pathname,u=JSON.parse(JSON.stringify(l.options.routes)),d=c.split("/")[1],p=b([d?`/${d}`:"/"]),m=u.filter((e=>e.name&&!e.hidden)).map((e=>{return i=((e,t)=>{for(var o in t||(t={}))n.call(t,o)&&s(e,o,t[o]);if(r)for(var o of r(t))a.call(t,o)&&s(e,o,t[o]);return e})({},e),t(i,o({children:[]}));var i})),f=b(e.userinfo.name),h=b(e.userinfo.avatar);return y((()=>{f.value=e.userinfo.name,h.value=e.userinfo.avatar})),{activeMenu:p,navbarList:m,username:f,avatar:h,menuClickHandler({item:e,key:t,keyPath:o}){l.push({path:t})},handleSelect(e){"logout"===e&&i.emit("logout",e)},toIndex(){l.push("/")}}}}),Z={class:"flex navbar"},ee={class:"menu flex"},te=[(e=>(C("data-v-3b3358de"),e=e(),N(),e))((()=>O("div",{class:"title"},"Genki Forest",-1)))],oe={class:"menu-list"},re={class:"navbar-dropdown"};const ne={class:"footer"};const ae={class:"main"},se={class:"container"};var ie=X({name:"App",components:{Navbar:X(Y,[["render",function(e,t,o,r,n,a){const s=_("a-menu-item"),i=_("a-sub-menu"),l=_("a-menu"),c=_("User-outlined"),u=_("a-avatar"),d=_("Down-outlined"),p=_("Appstore-add-outlined"),m=_("Logout-outlined"),f=_("a-dropdown");return w(),L("div",Z,[O("div",ee,[O("div",{class:"logo-area",onClick:t[0]||(t[0]=(...t)=>e.toIndex&&e.toIndex(...t))},te),O("div",oe,[k(l,{selectedKeys:e.activeMenu,"onUpdate:selectedKeys":t[1]||(t[1]=t=>e.activeMenu=t),mode:"horizontal",onClick:e.menuClickHandler},{default:I((()=>[(w(!0),L(S,null,j(e.navbarList,((e,t)=>(w(),L(S,{key:e.path},[Array.isArray(e.children)&&e.children.length>0?(w(),A(i,{key:e.path},{title:I((()=>[D(U(e.title),1)])),default:I((()=>[(w(!0),L(S,null,j(e.children,((e,t)=>(w(),A(s,{key:e.id},{default:I((()=>[D(U(e.title),1)])),_:2},1024)))),128))])),_:2},1024)):(w(),A(s,{key:e.path},{default:I((()=>[D(U(e.title),1)])),_:2},1024))],64)))),128))])),_:1},8,["selectedKeys","onClick"])])]),O("div",re,[k(f,null,{overlay:I((()=>[k(l,null,{default:I((()=>[k(s,null,{icon:I((()=>[k(p)])),default:I((()=>[O("a",{href:"javascript:;",onClick:t[3]||(t[3]=t=>e.handleSelect("auth"))},"权限申请")])),_:1}),k(s,null,{icon:I((()=>[k(m)])),default:I((()=>[O("a",{href:"javascript:;",onClick:t[4]||(t[4]=t=>e.handleSelect("logout"))},"注销登录")])),_:1})])),_:1})])),default:I((()=>[O("div",{class:"ant-dropdown-link",onClick:t[2]||(t[2]=E((()=>{}),["prevent"]))},[k(u,{src:e.avatar,size:"small"},P({_:2},[e.avatar?void 0:{name:"icon",fn:I((()=>[k(c)]))}]),1032,["src"]),D(" "+U(e.username)+" ",1),k(d)])])),_:1})])])}],["__scopeId","data-v-3b3358de"]]),Footer:X({},[["render",function(e,t,o,r,n,a){return w(),L("div",ne," footer ")}],["__scopeId","data-v-0875f754"]])},setup(e,t){const o=V({name:x((()=>Q.getters.name)),avatar:x((()=>Q.getters.avatar))}),r=window.location.pathname,n=b(!r.includes("/to-client"));return R((()=>Q.getters.navbarVisible),(e=>{n.value=e})),{locale:$,navbarVisible:n,userinfo:o,navbarData:[],ssoLogout:H,currentPath:r}}},[["render",function(e,t,o,r,n,a){const s=_("router-view"),i=_("Navbar"),l=_("a-config-provider");return w(),A(l,{locale:r.locale},{default:I((()=>[r.navbarVisible?(w(),L(S,{key:1},[k(i,{data:r.navbarData,userinfo:r.userinfo,onLogout:r.ssoLogout},null,8,["data","userinfo","onLogout"]),O("div",ae,[O("div",se,[k(s)])])],64)):(w(),A(s,{key:0}))])),_:1},8,["locale"])}]]);const le={},ce=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in le)return;le[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise(((e,t)=>{r.addEventListener("load",e),r.addEventListener("error",t)})):void 0}))).then((()=>e())):e()},ue=[{path:"/",name:"home",title:"首页",component:()=>ce((()=>import("./index.4d996c5e.js")),["static/index.4d996c5e.js","static/index.7bf94d6c.css","static/vendor.946f890b.js"]),props:!0},{path:"/error",component:()=>ce((()=>import("./error.30899df7.js")),["static/error.30899df7.js","static/error.3a19ce08.css","static/vendor.946f890b.js"])},{name:"statistics",title:"统计中心",path:"/statistics",component:()=>ce((()=>import("./index.765b8f33.js")),["static/index.765b8f33.js","static/index.d581b42a.css","static/vendor.946f890b.js"]),redpot:!1,redirect:"/statistics/home",children:[{path:"/statistics/home",component:()=>ce((()=>import("./index.8183b1eb.js")),["static/index.8183b1eb.js","static/index.a7b88a59.css","static/vendor.946f890b.js"]),title:"首页",icon:"bar-chart-outlined"}]}],de=M({history:T(),routes:ue});var pe={install(e){}};const me=(B=new F(fe={api:"/api/sso/login",loginUrl:"/api/sso/redirect",logoutUrl:"/api/sso/logout-redirect"}),B.handleLogin(fe),B);var fe;const he=q(ie);he.use(de),he.use(Q),he.use(pe),he.use(z),he.use(me);const ge=window;ge.$message=c,ge.$modal=J;const ve=K;for(const be in ve){const e=ve[be];he.component(be,e)}he.mount("#app");export{X as _,W as s};
